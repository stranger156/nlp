# 基于CNN和RNN的文本情感分类

本项目旨在使用深度学习模型（主要是卷积神经网络CNN和循环神经网络RNN）进行文本情感分类。模型被训练来识别给定文本数据的情感倾向（正面或负面）。项目包括数据预处理、模型训练和评估的相关脚本。

## 项目结构

- **preprocess.py**: 负责数据预处理工作，包括以下步骤：
  1. **数据读取**: 从`train.tsv`和`test.tsv`文件中读取训练数据和测试数据。
  2. **句子处理**: 对句子进行分词、添加特殊标记（如`<SOS>`、`<EOS>`），并进行填充使得所有句子长度一致。
  3. **词表构建**: 使用训练数据构建词汇表，并将词汇表保存为`vocab.txt`文件。
  4. **ID替换**: 将处理后的句子替换为对应的单词ID序列。
  5. **数据保存**: 将处理后的训练集和测试集保存为新的`new_train.tsv`和`new_test.tsv`文件。

- **split_train.py**: 将经过预处理的训练数据集`new_train.tsv`按照7:3的比例划分为训练集和验证集，并将其分别保存为`new_train.tsv`和`new_val.tsv`文件。

- **cnn_model.py**: 定义并实现了用于文本情感分类的卷积神经网络模型。具体功能如下：
  1. **词嵌入矩阵构建**: 从预训练的词向量（如Word2Vec或GloVe）中加载词向量，构建嵌入矩阵。
  2. **CNN模型定义**: 
     - 嵌入层：将输入的词ID序列转换为词向量。
     - 卷积层：通过多个卷积核提取文本的局部特征。
     - 线性层：将卷积后的特征映射到分类空间。
     - Softmax层：生成分类概率分布。
  3. **模型运行**: 提供样例输入，展示模型的前向传播结果。

- **rnn_model.py**: 定义并实现了用于文本情感分类的循环神经网络模型。具体功能如下：
  1. **词嵌入矩阵构建**: 从预训练的词向量（如Word2Vec或GloVe）中加载词向量，构建嵌入矩阵。
  2. **RNN模型定义**: 
     - 嵌入层：将输入的词ID序列转换为词向量。
     - LSTM层：使用双向LSTM（如果启用）对文本序列进行编码，提取全局特征。
     - 全连接层：将LSTM的输出映射到情感分类空间。
     - Softmax层：生成分类概率分布。
  3. **标签平滑交叉熵**: 使用标签平滑技术来缓解模型对某些类别的过度自信，防止过拟合。
  4. **模型运行**: 提供样例输入，展示模型的前向传播结果。

- **run_cnn.py**: 运行并训练CNN模型，并进行评估和预测。具体步骤如下：
  1. **数据加载与处理**: 读取并处理训练集、验证集和测试集，将其转换为Tensor格式并创建数据加载器。
  2. **模型初始化与训练**: 使用预训练的Word2Vec嵌入矩阵初始化CNN模型，并应用自定义权重初始化方法。在训练过程中，模型会通过优化器和损失函数进行更新。
  3. **模型评估与预测**: 在每个训练周期后，使用验证集评估模型性能，并最终使用测试集生成预测结果并保存为`predict_result_cnn_word2vec.csv`。
  4. **模型保存**: 训练完成后，将模型的状态字典保存为`cnn_model_word2vec.pth`文件。可以在预测时重新加载模型状态进行推断。

- **run_rnn.py**: 运行并训练RNN模型，并进行评估和预测。具体步骤如下：
  1. **数据加载与处理**: 读取并处理训练集、验证集和测试集，将其转换为Tensor格式并创建数据加载器。
  2. **模型初始化与训练**: 使用预训练的GloVe嵌入矩阵初始化RNN模型，并应用自定义权重初始化方法。在训练过程中，模型会通过优化器和损失函数进行更新。
  3. **模型评估与预测**: 在每个训练周期后，使用验证集评估模型性能，并最终使用测试集生成预测结果并保存为`predict_result_glove_batch128.csv`。
  4. **模型保存与加载**: 训练完成后，将模型的状态字典保存为`rnn_model_glove_batch128.pth`文件。可以在预测时重新加载模型状态进行推断。

## 使用说明

1. **数据预处理**: 首先运行`preprocess.py`脚本，对原始数据进行清洗、分词、词表构建，并将文本转换为ID序列。
   ```bash
   python preprocess.py
   ```

2. **数据集划分**: 使用`split_train.py`将预处理后的数据集`new_train.tsv`按照7:3的比例划分为训练集和验证集。
   ```bash
   python split_train.py
   ```

3. **训练CNN模型**:
   - **定义嵌入矩阵**: 运行`cnn_model.py`中的`get_embedding_matrix`函数生成嵌入矩阵。
   - **初始化CNN模型**: 使用生成的嵌入矩阵初始化CNN模型，并应用权重初始化。
   - **训练模型**: 使用`run_cnn.py`中的`train_model`函数训练模型，并在每个训练周期后进行验证。
   - **保存模型**: 训练完成后，将模型的状态字典保存为`cnn_model_word2vec.pth`。
   - **生成预测结果**: 训练完成后，使用`predict`函数生成测试集的预测结果，并保存为`predict_result_cnn_word2vec.csv`。
   ```bash
   python run_cnn.py
   ```

4. **训练RNN模型**:
   - **定义嵌入矩阵**: 运行`rnn_model.py`中的`get_embedding_matrix`函数生成嵌入矩阵。
   - **初始化RNN模型**: 使用生成的嵌入矩阵初始化RNN模型，并应用权重初始化。
   - **训练模型**: 使用`run_rnn.py`中的`train_model`函数训练模型，并在每个训练周期后进行验证。
   - **保存模型**: 训练完成后，将模型的状态字典保存为`rnn_model_glove_batch128.pth`。
   - **生成预测结果**: 使用`predict`函数生成测试集的预测结果，并保存为`predict_result_glove_batch128.csv`。
   ```bash
   python run_rnn.py
   ```

## 依赖环境

- Python 3.8.19
- PyTorch
- NumPy
- Pandas
- scikit-learn
- Gensim
- 其他相关的Python库

## 贡献者

- 金方琢
- 刘杰
- 李承远
- 曹沛
- 郑伊恬


